---
title: "Class10"
author: "Yuxuan Jiang A17324184"
format: html
toc: true
---
## Introduction to the RCSB Protein Data Bank (PDB)

The Protein Data Bank(PDB) is the main repository of biomolecular structure.
### PDB statistics
```{r}
PDB.data <- read.csv('Data Export Summary.csv',row.names = 1)
PDB <- data.frame(PDB.data)
PDB
```


>Q1: What percentage of structures in the PDB are solved by X-Ray and Electron Microscopy.

The comma in these numbers leads to the numbers here being read as character.
```{r, message=FALSE}
library(readr)
stats <- read_csv('Data Export Summary.csv')
stats
n.Xray <- sum(stats$`X-ray`)
n.Total <- sum(stats$`Total`)
per.Xray <- n.Xray/n.Total
per.Xray
```
80.95% of structures in the PDB are solved by X-Ray and Electron Microscopy.

>Q2: What proportion of structures in the PDB are protein?

```{r}
per.protein <- stats[1,'Total']/n.Total
per.protein
```
85.97% of structures in the PDB are protein (only).

> Q3: Type HIV in the PDB website search box on the home page and determine how many HIV-1 protease structures are in the current PDB?

644 HIV-1 protease structures are in the current PDB.

## Visualizing the HIV-1 protease structure

![HIV-pr 1HSG with surface display showing ligand binding](1HSG.png)

>Q4: Water molecules normally have 3 atoms. Why do we see just one atom per water molecule in this structure?

The structure was constructed using X-RAY DIFFRACTION according to the PDB website. As the electron density of hydrogen atoms was too weak to be detected, the X-RAY DIFFRACTION only showed the oxygen atoms as the have a much stronger electron density.

>Q5: There is a critical “conserved” water molecule in the binding site. Can you identify this water molecule? What residue number does this water molecule have

HOH308

>Q6: Generate and save a figure clearly showing the two distinct chains of HIV-protease along with the ligand. You might also consider showing the catalytic residues ASP 25 in each chain and the critical water (we recommend “Ball & Stick” for these side-chains). Add this figure to your Quarto document.

![HIV-pr 1HSG highlighting ASP25 amino acids in both chains of the HIV-PR dimer along with the inhibitor and the all important active site water](1HSG (1).png)

## Bio3D package for structural bioinformatics 

```{r}
library(bio3d)
pdb <- read.pdb("1hsg")
pdb
```

>Q7: How many amino acid residues are there in this pdb object?

198

>Q8: Name one of the two non-protein residues? 

HOH (127)

>Q9: How many protein chains are in this structure?

2 (chain A &B)

```{r}
head(pdb$atom)
```

```{r}
#library(bio3dview)
#library(NGLVieweR)
#view.pdb(pdb) |>
#  setSpin()
```

```{r}
# Select the important ASP 25 residue
#sele <- atom.select(pdb, resno=25)

# and highlight them in spacefill representation
#view.pdb(pdb, cols=c("navy","teal"), 
#         highlight = sele,
#         highlight.style = "spacefill") |>
#  setRock()
```

## Predicting functional motions of a single structure

Read an ADK structure from the PDB database:

```{r}
adk <- read.pdb("6s36")
adk
```

```{r}
m <- nma(adk)
plot(m)
```

Write out our results as we trajectory/movie of predicted motions:

```{r}
mktrj(m, file="adk_m7.pdb")
```

## Comparative structure analysis with PCA 

First step: Find an ADK sequence:

```{r}
library(bio3d)
id <- "1ake_A"
aa <- get.seq(id)
aa
```

Second step: Search PDB database for all related entries:

```{r}
blast <- blast.pdb(aa)
hits <- plot(blast)
```

```{r}
head(blast$hit.tbl)
```

The "top hits" are in the `hits` object. Now we can download these to our computer.

```{r}
# Download related PDB files.
files <- get.pdb(hits$pdb.id, path='pdbs',split=TRUE,gzip = TRUE)
```

This look like a hot mess
![](1AKE-1E4V-1E4Y-3HPR-3X2S-4K46-4NP6-4X8H-4X8M-5EJE-6HAM-6HAP-6RZE-6S36-8BQF-8PVW-8Q2B-8RJ9-9R6U-9R71.png)

Next we will use the `pdbaln()` function to align and also optionally fit (i.e. superpose) the identified PDB structures.

This require a BioConducter package called "msa" that we need to install. 
First we install BiocManager. Then we use `BiocManager::install("msa")`.

```{r}
# Align related PDBs
pdbs <- pdbaln(files, fit = TRUE, exefile="msa")
```

```{r}
pdbs
```

```{r}
library(bio3dview)
view.pdb(pdbs,colorScheme = "residue")
```
## PCA
We can run PC on our `pdbs` object using the `pca()` function from **bio3d**

```{r}
pc.xray <- pca(pdbs)
plot(pc.xray)
```

```{r}
plot(pc.xray,1:2)
```

```{r}
# Calculate RMSD
rd <- rmsd(pdbs)

# Structure-based clustering
hc.rd <- hclust(dist(rd))
grps.rd <- cutree(hc.rd, k=3)

plot(pc.xray, 1:2, col="grey50", bg=grps.rd, pch=21, cex=1)
```

We can make a visualization of the major conformational difference (i.e. large scale structure change) captured by our PCA with the `mktrj()` function.

```{r}
pc1 <- mktrj(pc.xray,file="pca.pdb")
```

Let's see in Mol-star.